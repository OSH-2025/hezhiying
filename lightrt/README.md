# LightRT

**LightRT** is a lightweight operating system framework for STM32 F1 devices (ARM Cortex-M) by Hezhiying Team @ OSH course, 2025 spring semester at USTC. The system is written in a simplicity-first style.

## Construction

The entire system is written in C programming language and ARM assembly (for low level operations). There are several parts:

- `main.c`: Entry code and initialization
- `task.c` and `task.h`: Task management
- `uart.c` and `uart.h`: UART message print
- `svcentry.c`, `svc.h`, `user/syscall.c`, `user/syscall.h`: Syscall support; these files are automatically generated by `svcc` utility with `svc.def` definitions during build process.
- `svcimpl.c`: Implements the syscall routines. 
- `errno.h`: Global error code definitions
- `lightrt.h`: Global system header file

## Building

Building the system is relatively easy. Just use GNU `make` and you will get the `firmware.bin` / `firmware.elf` binaries.

The building process requires the `libopencm3` (installed at `libopencm3/`). Building of this library is included in the Makefile and will be done automatically.

Note: When you build for the first time the GCC would report undefined references (they are from automatically generated files but these files are not scanned by `make` after generation). Use `make` for the second time will fix this issue.

## Testing

Renode is used to simulate the real running environment. You can use `make start` to start a Renode instance from `renode/` (requires Renode binary at `renode/renode`). Use `make gdb` to start a GDB multiarch for debugging and connect it to the Renode simulator.
